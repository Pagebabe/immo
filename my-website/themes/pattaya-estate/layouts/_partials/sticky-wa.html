<!-- Sticky WhatsApp Button -->
<div class="sticky-whatsapp">
    <a href="https://wa.me/66XXXXXXXXX?text=Hallo%2C%20ich%20interessiere%20mich%20fÃ¼r%20Immobilien%20in%20Pattaya" 
       class="whatsapp-btn" 
       target="_blank" 
       rel="noopener noreferrer"
       aria-label="WhatsApp Chat">
        <i class="icon-whatsapp"></i>
        <span class="whatsapp-text">{{ i18n "whatsapp_chat" | default "WhatsApp Chat" }}</span>
    </a>
</div>

<!-- Cal.com Booking Widget -->
<div class="cal-booking-widget" id="cal-booking-widget" style="display: none;">
    <div class="cal-widget-header">
        <h4>{{ i18n "book_consultation" | default "Beratungstermin buchen" }}</h4>
        <button class="cal-close" onclick="closeCalWidget()">
            <i class="icon-close"></i>
        </button>
    </div>
    <div class="cal-widget-content">
        <iframe src="https://cal.com/pattaya-living-estate" 
                width="100%" 
                height="600" 
                frameborder="0"
                title="Cal.com Booking Widget">
        </iframe>
    </div>
</div>

<!-- Cal.com Trigger Button -->
<div class="cal-trigger-btn" onclick="openCalWidget()">
    <i class="icon-calendar"></i>
    <span>{{ i18n "book_meeting" | default "Termin buchen" }}</span>
</div>

<style>
.sticky-whatsapp {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
}

.whatsapp-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #25D366;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 50px;
    text-decoration: none;
    font-weight: 600;
    box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
    transition: all 0.3s ease;
    animation: pulse 2s infinite;
}

.whatsapp-btn:hover {
    background: #20BA5A;
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(37, 211, 102, 0.4);
    color: white;
    text-decoration: none;
}

.whatsapp-btn i {
    font-size: 1.5rem;
}

.whatsapp-text {
    font-size: 0.9rem;
}

@keyframes pulse {
    0% {
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
    }
    50% {
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.6);
    }
    100% {
        box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
    }
}

.cal-trigger-btn {
    position: fixed;
    bottom: 20px;
    right: 200px;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: #667eea;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 50px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
    transition: all 0.3s ease;
}

.cal-trigger-btn:hover {
    background: #5a6fd8;
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
}

.cal-booking-widget {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 800px;
    height: 80vh;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    z-index: 2000;
    overflow: hidden;
}

.cal-widget-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
}

.cal-widget-header h4 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c3e50;
}

.cal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #6c757d;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.2s ease;
}

.cal-close:hover {
    background: #e9ecef;
    color: #2c3e50;
}

.cal-widget-content {
    height: calc(100% - 80px);
    overflow: hidden;
}

.cal-widget-content iframe {
    border: none;
    width: 100%;
    height: 100%;
}

/* Mobile adjustments */
@media (max-width: 768px) {
    .sticky-whatsapp {
        bottom: 15px;
        right: 15px;
    }
    
    .whatsapp-btn {
        padding: 0.75rem 1rem;
    }
    
    .whatsapp-text {
        display: none;
    }
    
    .cal-trigger-btn {
        bottom: 15px;
        right: 80px;
        padding: 0.75rem 1rem;
    }
    
    .cal-trigger-btn span {
        display: none;
    }
    
    .cal-booking-widget {
        width: 95%;
        height: 90vh;
    }
}

/* Overlay for modal */
.cal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1999;
}
</style>

<script>
function openCalWidget() {
    const widget = document.getElementById('cal-booking-widget');
    const overlay = document.createElement('div');
    overlay.className = 'cal-overlay';
    overlay.onclick = closeCalWidget;
    
    document.body.appendChild(overlay);
    widget.style.display = 'block';
    document.body.style.overflow = 'hidden';
    
    // Track event
    if (typeof gtag !== 'undefined') {
        gtag('event', 'cal_widget_open', {
            'event_category': 'engagement',
            'event_label': 'booking_widget'
        });
    }
}

function closeCalWidget() {
    const widget = document.getElementById('cal-booking-widget');
    const overlay = document.querySelector('.cal-overlay');
    
    widget.style.display = 'none';
    if (overlay) {
        overlay.remove();
    }
    document.body.style.overflow = 'auto';
}

// Close on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeCalWidget();
    }
});
</script>
