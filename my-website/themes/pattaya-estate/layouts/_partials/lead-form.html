<!-- Multi-Step Lead Generation Form -->
<div class="lead-form-container">
    <div class="lead-form-header">
        <h3>{{ i18n "free_consultation" | default "Kostenlose Beratung" }}</h3>
        <p>{{ i18n "lead_form_desc" | default "Erhalten Sie eine kostenlose und unverbindliche Beratung für Ihre Immobilieninvestition in Pattaya" }}</p>
    </div>
    
    <form id="lead-form" class="lead-form" action="https://hooks.n8n.cloud/webhook/your-webhook-id" method="POST">
        <!-- Step 1: Basic Information -->
        <div class="form-step active" data-step="1">
            <div class="step-header">
                <span class="step-number">1</span>
                <h4>{{ i18n "basic_information" | default "Grundinformationen" }}</h4>
            </div>
            
            <div class="form-group">
                <label for="firstName">{{ i18n "first_name" | default "Vorname" }} *</label>
                <input type="text" id="firstName" name="firstName" required>
            </div>
            
            <div class="form-group">
                <label for="lastName">{{ i18n "last_name" | default "Nachname" }} *</label>
                <input type="text" id="lastName" name="lastName" required>
            </div>
            
            <div class="form-group">
                <label for="email">{{ i18n "email" | default "E-Mail" }} *</label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="phone">{{ i18n "phone" | default "Telefon" }} *</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            
            <div class="form-group">
                <label for="country">{{ i18n "country" | default "Land" }} *</label>
                <select id="country" name="country" required>
                    <option value="">{{ i18n "select_country" | default "Land auswählen" }}</option>
                    <option value="DE">Deutschland</option>
                    <option value="AT">Österreich</option>
                    <option value="CH">Schweiz</option>
                    <option value="TH">Thailand</option>
                    <option value="other">{{ i18n "other" | default "Andere" }}</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="nextStep()">
                    {{ i18n "next_step" | default "Weiter" }}
                    <i class="icon-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 2: Property Preferences -->
        <div class="form-step" data-step="2">
            <div class="step-header">
                <span class="step-number">2</span>
                <h4>{{ i18n "property_preferences" | default "Immobilienwünsche" }}</h4>
            </div>
            
            <div class="form-group">
                <label for="interest">{{ i18n "interest_type" | default "Interesse" }} *</label>
                <select id="interest" name="interest" required>
                    <option value="">{{ i18n "select_interest" | default "Interesse auswählen" }}</option>
                    <option value="buy">{{ i18n "buy_property" | default "Immobilie kaufen" }}</option>
                    <option value="sell">{{ i18n "sell_property" | default "Immobilie verkaufen" }}</option>
                    <option value="rent">{{ i18n "rent_property" | default "Immobilie mieten" }}</option>
                    <option value="manage">{{ i18n "property_management" | default "Property Management" }}</option>
                    <option value="consultation">{{ i18n "general_consultation" | default "Allgemeine Beratung" }}</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="propertyType">{{ i18n "preferred_type" | default "Bevorzugter Typ" }}</label>
                <select id="propertyType" name="propertyType">
                    <option value="">{{ i18n "any_type" | default "Beliebig" }}</option>
                    <option value="condo">{{ i18n "condo" | default "Condo" }}</option>
                    <option value="villa">{{ i18n "villa" | default "Villa" }}</option>
                    <option value="townhouse">{{ i18n "townhouse" | default "Townhouse" }}</option>
                    <option value="penthouse">{{ i18n "penthouse" | default "Penthouse" }}</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="budget">{{ i18n "budget_range" | default "Budget" }}</label>
                <select id="budget" name="budget">
                    <option value="">{{ i18n "select_budget" | default "Budget auswählen" }}</option>
                    <option value="under-3m">Unter 3 Mio. THB</option>
                    <option value="3m-5m">3-5 Mio. THB</option>
                    <option value="5m-10m">5-10 Mio. THB</option>
                    <option value="10m-20m">10-20 Mio. THB</option>
                    <option value="over-20m">Über 20 Mio. THB</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="location">{{ i18n "preferred_location" | default "Bevorzugte Lage" }}</label>
                <select id="location" name="location">
                    <option value="">{{ i18n "any_location" | default "Beliebig" }}</option>
                    <option value="jomtien">Jomtien</option>
                    <option value="pratumnak">Pratumnak</option>
                    <option value="central">Central Pattaya</option>
                    <option value="naklua">Naklua</option>
                    <option value="wongamat">Wongamat</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="timeline">{{ i18n "timeline" | default "Zeitrahmen" }}</label>
                <select id="timeline" name="timeline">
                    <option value="">{{ i18n "select_timeline" | default "Zeitrahmen auswählen" }}</option>
                    <option value="immediate">{{ i18n "immediate" | default "Sofort" }}</option>
                    <option value="1-3months">{{ i18n "1_3_months" | default "1-3 Monate" }}</option>
                    <option value="3-6months">{{ i18n "3_6_months" | default "3-6 Monate" }}</option>
                    <option value="6-12months">{{ i18n "6_12_months" | default "6-12 Monate" }}</option>
                    <option value="planning">{{ i18n "just_planning" | default "Nur Planung" }}</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="prevStep()">
                    <i class="icon-arrow-left"></i>
                    {{ i18n "previous" | default "Zurück" }}
                </button>
                <button type="button" class="btn btn-primary" onclick="nextStep()">
                    {{ i18n "next_step" | default "Weiter" }}
                    <i class="icon-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 3: Additional Information -->
        <div class="form-step" data-step="3">
            <div class="step-header">
                <span class="step-number">3</span>
                <h4>{{ i18n "additional_info" | default "Zusätzliche Informationen" }}</h4>
            </div>
            
            <div class="form-group">
                <label for="message">{{ i18n "message" | default "Nachricht" }}</label>
                <textarea id="message" name="message" rows="4" placeholder="{{ i18n "message_placeholder" | default "Teilen Sie uns Ihre spezifischen Wünsche oder Fragen mit..." }}"></textarea>
            </div>
            
            <div class="form-group">
                <label for="newsletter" class="checkbox-label">
                    <input type="checkbox" id="newsletter" name="newsletter" value="yes">
                    <span class="checkmark"></span>
                    {{ i18n "newsletter_signup" | default "Ich möchte den Newsletter mit Immobilien-Updates erhalten" }}
                </label>
            </div>
            
            <div class="form-group">
                <label for="privacy" class="checkbox-label">
                    <input type="checkbox" id="privacy" name="privacy" value="yes" required>
                    <span class="checkmark"></span>
                    {{ i18n "privacy_consent" | default "Ich stimme der Verarbeitung meiner Daten zu" }} *
                </label>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="prevStep()">
                    <i class="icon-arrow-left"></i>
                    {{ i18n "previous" | default "Zurück" }}
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="icon-send"></i>
                    {{ i18n "send_request" | default "Anfrage senden" }}
                </button>
            </div>
        </div>
        
        <!-- Success Message -->
        <div class="form-success" style="display: none;">
            <div class="success-icon">
                <i class="icon-check"></i>
            </div>
            <h4>{{ i18n "request_sent" | default "Anfrage erfolgreich gesendet!" }}</h4>
            <p>{{ i18n "success_message" | default "Vielen Dank für Ihre Anfrage. Wir werden uns innerhalb von 24 Stunden bei Ihnen melden." }}</p>
            <div class="success-actions">
                <a href="https://wa.me/66XXXXXXXXX" class="btn btn-success" target="_blank">
                    <i class="icon-whatsapp"></i>
                    WhatsApp Chat
                </a>
                <a href="https://cal.com/pattaya-living-estate" class="btn btn-primary" target="_blank">
                    <i class="icon-calendar"></i>
                    Termin buchen
                </a>
            </div>
        </div>
    </form>
</div>

<script>
let currentStep = 1;
const totalSteps = 3;

function nextStep() {
    if (validateStep(currentStep)) {
        if (currentStep < totalSteps) {
            document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
            currentStep++;
            document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
            updateProgressBar();
        }
    }
}

function prevStep() {
    if (currentStep > 1) {
        document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
        currentStep--;
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
        updateProgressBar();
    }
}

function validateStep(step) {
    const stepElement = document.querySelector(`[data-step="${step}"]`);
    const requiredFields = stepElement.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('error');
            isValid = false;
        } else {
            field.classList.remove('error');
        }
    });
    
    return isValid;
}

function updateProgressBar() {
    const progress = (currentStep / totalSteps) * 100;
    // Add progress bar if needed
}

// Form submission
document.getElementById('lead-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (validateStep(currentStep)) {
        const formData = new FormData(this);
        
        // Add additional data
        formData.append('source', 'website');
        formData.append('timestamp', new Date().toISOString());
        formData.append('language', 'de');
        
        fetch(this.action, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // Show success message
                document.querySelectorAll('.form-step').forEach(step => {
                    step.style.display = 'none';
                });
                document.querySelector('.form-success').style.display = 'block';
                
                // Track conversion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'lead_form_submit', {
                        'event_category': 'engagement',
                        'event_label': 'multi_step_form'
                    });
                }
            } else {
                throw new Error('Form submission failed');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('{{ i18n "form_error" | default "Es gab einen Fehler beim Senden Ihrer Anfrage. Bitte versuchen Sie es erneut." }}');
        });
    }
});

// Remove error class on input
document.querySelectorAll('input, select, textarea').forEach(field => {
    field.addEventListener('input', function() {
        this.classList.remove('error');
    });
});
</script>
