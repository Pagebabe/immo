<div class="lead-form-container">
  <div class="lead-form-header">
    <h3>🏠 Kostenlose Immobilienberatung</h3>
    <p>Lassen Sie sich von unseren Experten beraten - unverbindlich und kostenlos!</p>
  </div>
  
  <form class="lead-form" action="https://DEIN-N8N/webhook/lead-intake" method="post" id="lead-form">
    <div class="form-step active" data-step="1">
      <h4>📋 Ihre Kontaktdaten</h4>
      <div class="form-group">
        <input name="name" placeholder="Vollständiger Name *" required>
        <span class="form-hint">Für die persönliche Ansprache</span>
      </div>
      <div class="form-group">
        <input name="phone" placeholder="Telefon / WhatsApp *" required type="tel">
        <span class="form-hint">Für schnelle Rückfragen</span>
      </div>
      <div class="form-group">
        <input name="email" placeholder="E-Mail Adresse" type="email">
        <span class="form-hint">Für Dokumente und Updates</span>
      </div>
      <button type="button" class="btn btn-primary next-step">Weiter →</button>
    </div>
    
    <div class="form-step" data-step="2">
      <h4>🎯 Ihr Immobilienwunsch</h4>
      <div class="form-group">
        <select name="intent" required>
          <option value="">Was möchten Sie? *</option>
          <option value="kaufen">🏠 Immobilie kaufen</option>
          <option value="mieten">🏡 Immobilie mieten</option>
          <option value="verkaufen">💰 Immobilie verkaufen</option>
          <option value="verwaltung">🔧 Property Management</option>
        </select>
      </div>
      <div class="form-group">
        <input name="budget" placeholder="Budget (THB)" type="number" min="0">
        <span class="form-hint">Unverbindlich - hilft uns bei der Auswahl</span>
      </div>
      <div class="form-group">
        <select name="area">
          <option value="">Bevorzugter Stadtteil</option>
          <option value="jomtien">🏖️ Jomtien</option>
          <option value="pratumnak">🌴 Pratumnak</option>
          <option value="wongamat">🏖️ Wongamat</option>
          <option value="central">🏙️ Central Pattaya</option>
          <option value="naklua">🌊 Naklua</option>
        </select>
      </div>
      <div class="form-group">
        <select name="move_in">
          <option value="">Wann möchten Sie?</option>
          <option value="sofort">⚡ Sofort</option>
          <option value="1-3_monate">📅 1-3 Monate</option>
          <option value="3-6_monate">📅 3-6 Monate</option>
          <option value="spaeter">📅 Später</option>
        </select>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary prev-step">← Zurück</button>
        <button type="button" class="btn btn-primary next-step">Weiter →</button>
      </div>
    </div>
    
    <div class="form-step" data-step="3">
      <h4>💬 Zusätzliche Informationen</h4>
      <div class="form-group">
        <textarea name="message" placeholder="Beschreiben Sie kurz Ihre Wünsche, besondere Anforderungen oder Fragen..."></textarea>
        <span class="form-hint">Je mehr Details, desto besser können wir Ihnen helfen</span>
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" name="newsletter" value="yes">
          <span class="checkmark"></span>
          📧 Ich möchte über neue Immobilien und Marktupdates informiert werden
        </label>
      </div>
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" name="privacy" value="yes" required>
          <span class="checkmark"></span>
          ✅ Ich habe die <a href="/de/privacy/" target="_blank">Datenschutzerklärung</a> gelesen und stimme zu *
        </label>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary prev-step">← Zurück</button>
        <button type="submit" class="btn btn-success">
          🚀 Kostenlose Beratung anfordern
        </button>
      </div>
    </div>
    
    <div class="form-progress">
      <div class="progress-bar">
        <div class="progress-fill" style="width: 33%"></div>
      </div>
      <span class="progress-text">Schritt 1 von 3</span>
    </div>
  </form>
  
  <div class="lead-form-footer">
    <p>🔒 Ihre Daten sind sicher und werden nicht an Dritte weitergegeben</p>
    <p>⚡ Antwort innerhalb von 24 Stunden garantiert</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('lead-form');
    if (!form) return;
    
    let currentStep = 1;
    const totalSteps = 3;
    
    // Multi-step form functionality
    function showStep(step) {
        // Hide all steps
        document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
        
        // Show current step
        document.querySelector(`[data-step="${step}"]`).classList.add('active');
        
        // Update progress bar
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');
        const progress = (step / totalSteps) * 100;
        
        progressFill.style.width = progress + '%';
        progressText.textContent = `Schritt ${step} von ${totalSteps}`;
        
        // Track step progression
        if (typeof gtag !== 'undefined') {
            gtag('event', 'form_step_view', {
                form_name: 'lead_form',
                step_number: step,
                page_location: window.location.href
            });
        }
    }
    
    // Next step functionality
    document.addEventListener('click', function(e) {
        if (e.target.matches('.next-step')) {
            e.preventDefault();
            
            // Validate current step
            const currentStepElement = document.querySelector(`[data-step="${currentStep}"]`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.classList.remove('error');
                }
            });
            
            if (isValid && currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                
                // Track step completion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'form_step_complete', {
                        form_name: 'lead_form',
                        step_number: currentStep - 1,
                        page_location: window.location.href
                    });
                }
            }
        }
        
        // Previous step functionality
        if (e.target.matches('.prev-step')) {
            e.preventDefault();
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
    });
    
    // Form interaction tracking
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.classList.remove('error');
            if (typeof gtag !== 'undefined') {
                gtag('event', 'form_field_focus', {
                    form_name: 'lead_form',
                    field_name: this.name,
                    step_number: currentStep,
                    page_location: window.location.href
                });
            }
        });
        
        input.addEventListener('blur', function() {
            if (this.value.length > 0) {
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'form_field_complete', {
                        form_name: 'lead_form',
                        field_name: this.name,
                        field_value: this.value,
                        step_number: currentStep,
                        page_location: window.location.href
                    });
                }
            }
        });
        
        // Real-time validation
        input.addEventListener('input', function() {
            if (this.hasAttribute('required') && this.value.trim()) {
                this.classList.remove('error');
            }
        });
    });
    
    // Form submission tracking
    form.addEventListener('submit', function(e) {
        const formData = new FormData(form);
        const intent = formData.get('intent');
        const budget = formData.get('budget');
        const area = formData.get('area');
        const name = formData.get('name');
        const phone = formData.get('phone');
        
        // Enhanced lead generation event
        if (typeof gtag !== 'undefined') {
            gtag('event', 'generate_lead', {
                currency: 'THB',
                value: budget ? parseInt(budget) : 1000000,
                transaction_id: 'lead_' + Date.now(),
                items: [{
                    item_id: 'lead_form',
                    item_name: 'Property Lead',
                    item_category: intent || 'unknown',
                    item_category2: area || 'unknown',
                    price: budget ? parseInt(budget) : 1000000,
                    quantity: 1
                }]
            });
            
            // Form completion event
            gtag('event', 'form_submit', {
                form_name: 'lead_form',
                form_destination: form.action,
                page_location: window.location.href,
                custom_parameter_1: intent,
                custom_parameter_2: area,
                custom_parameter_3: budget,
                custom_parameter_4: name,
                custom_parameter_5: phone
            });
            
            // Conversion tracking
            gtag('event', 'conversion', {
                send_to: 'AW-CONVERSION_ID/CONVERSION_LABEL',
                value: budget ? parseInt(budget) : 1000000,
                currency: 'THB',
                transaction_id: 'lead_' + Date.now()
            });
        }
        
        // Show success message
        setTimeout(() => {
            form.innerHTML = `
                <div class="form-success">
                    <h3>✅ Vielen Dank!</h3>
                    <p>Ihre Anfrage wurde erfolgreich übermittelt.</p>
                    <p>Unser Team wird sich innerhalb von 24 Stunden bei Ihnen melden.</p>
                    <div class="success-actions">
                        <a href="/de/properties/" class="btn btn-primary">Weitere Immobilien ansehen</a>
                        <a href="https://wa.me/66XXXXXXXXX" class="btn btn-success">WhatsApp Chat</a>
                    </div>
                </div>
            `;
        }, 1000);
    });
    
    // Initialize first step
    showStep(1);
});
</script>
